function e(e){if(e instanceof Error)return e.message||String(e);if(typeof e==`string`)return e;try{return JSON.stringify(e)}catch{return String(e)}}function t(t,n){if(n===`production`){let e=()=>{};return{info:e,warn:e,error:e,debug:e}}let r=`[${t}]`;return{info:(t,...n)=>{console.log(`${r} ${e(t)}`,...n)},warn:(t,...n)=>{console.warn(`${r} ${e(t)}`,...n)},error:(t,...n)=>{let i=e(t);console.error(`${r} ${i}`,...n)},debug:(t,...n)=>{console.debug(`${r} ${e(t)}`,...n)}}}var n=t;let r=function(e){return e.RUNTIME_ENV_ERROR=`运行环境错误`,e.NOT_INITIALIZED=`SDK未初始化，请先调用initService方法`,e.NOT_USER_INFO=`用户信息未设置，请先调用setUserInfo方法`,e.VIEWER_PARAMS_ERROR=`viewerId、viewerName、viewerAvatar不能为空`,e.USER_PARAMS_ERROR=`appId、userId、appSecret不能为空`,e.ROOM_PARAMS_ERROR=`sceneType、channelId不能为空`,e.HOST_ROOM_PARAMS_ERROR=`channelId、password、nickname不能为空`,e}({}),i=function(e){return e.LiveScenesPlugin=`PLV-LiveScenesPlugin`,e.LiveScenesHostPlugin=`PLV-LiveUniPlugin`,e}({});const a={[i.LiveScenesPlugin]:{watchPlay:`${i.LiveScenesPlugin}-PlayModule`,watchConfig:`${i.LiveScenesPlugin}-ConfigModule`},[i.LiveScenesHostPlugin]:{streamerConfig:`${i.LiveScenesHostPlugin}-StreamerConfigModule`,streamerPlay:`${i.LiveScenesHostPlugin}-StreamerLiveModule`,viewerConfig:`${i.LiveScenesHostPlugin}-WatchConfigModule`,viewerPlay:`${i.LiveScenesHostPlugin}-WatchPlayModule`}};var o=class{playModule;configModule;streamerConfigModule;streamerPlayModule;isInit=!1;userinfoDone=!1;os=`unknown`;platform=`unknown`;envInit=!1;pluginType;env;logger;get isInitialized(){return this.isInit}get hasUserInfo(){return this.userinfoDone}constructor(e){let{type:t=i.LiveScenesPlugin,env:r=`development`}=e||{};this.pluginType=t,this.env=r,this.logger=n(`PLVLiveScenesPluginHelper`,this.env),this.init(e)}_promisify(e){return new Promise((t,n)=>{e((e={})=>{let{isSuccess:r,errMsg:i=``,...a}=e;r?t(a):n(Error(i||`Native module call failed`))})})}detectEnv(){if(typeof uni>`u`)throw this.logger.error(`运行环境错误：仅支持uni-app`),Error(r.RUNTIME_ENV_ERROR);let e=uni.getSystemInfoSync&&uni.getSystemInfoSync()||{};if(this.platform=e.uniPlatform||this.platform,this.os=e.osName||this.os,this.platform!==`app`)throw this.logger.error(`运行环境错误：仅支持uni-app app模式`),Error(r.RUNTIME_ENV_ERROR);if(this.os!==`ios`&&this.os!==`android`)throw this.logger.error(`运行环境错误：仅支持 iOS 或 Android`),Error(r.RUNTIME_ENV_ERROR);this.logger.info(`运行环境：${this.platform} - ${this.os}`),this.logger.info(`插件类型：${this.pluginType}`)}bindModules(e){e===i.LiveScenesPlugin?(this.playModule=uni.requireNativePlugin(a[i.LiveScenesPlugin].watchPlay),this.configModule=uni.requireNativePlugin(a[i.LiveScenesPlugin].watchConfig)):(this.streamerConfigModule=uni.requireNativePlugin(a[i.LiveScenesHostPlugin].streamerConfig),this.streamerPlayModule=uni.requireNativePlugin(a[i.LiveScenesHostPlugin].streamerPlay),this.playModule=uni.requireNativePlugin(a[i.LiveScenesHostPlugin].viewerPlay),this.configModule=uni.requireNativePlugin(a[i.LiveScenesHostPlugin].viewerConfig))}init(e){let{type:t=i.LiveScenesPlugin}=e||{};this.detectEnv(),this.bindModules(t),this.envInit=!0}ensureEnv(){if(!this.envInit)throw this.logger.error(`运行环境错误：仅支持uni-app app模式`),Error(r.RUNTIME_ENV_ERROR)}checkSystem(){if(this.logger.info(`检查系统状态`,{isInit:this.isInit,userinfoDone:this.userinfoDone}),!this.isInit)throw Error(r.NOT_INITIALIZED);if(!this.userinfoDone)throw Error(r.NOT_USER_INFO)}},s=class extends o{constructor(e){super({...e})}async setViewerInfo({viewerId:e,viewerName:t,viewerAvatar:n}){if(this.ensureEnv(),!e||!t||!n)throw Error(r.VIEWER_PARAMS_ERROR);this.logger.info(`设置观看者信息`,{viewerId:e,viewerName:t});try{await this._promisify(r=>this.configModule.setViewerInfo({viewerId:e,viewerName:t,viewerAvatar:n},r)),this.logger.info(`设置观看者信息成功`)}catch(e){throw this.logger.error(`设置观看者信息失败`,e),e}}async setMarqueeConfig({code:e=``}){this.ensureEnv(),this.logger.info(`设置跑马灯配置`,{code:e});try{await this._promisify(t=>this.configModule.setMarqueeConfig({code:e},t)),this.logger.info(`设置跑马灯配置成功`)}catch(e){throw this.logger.error(`设置跑马灯配置失败`,e),e}}async initService({viewerId:e,viewerName:t,viewerAvatar:n,code:i=``}){try{if(this.ensureEnv(),this.isInit=!1,this.logger.info(`开始初始化服务`),!e||!t||!n)throw this.logger.error(`初始化服务失败，参数错误`,{viewerId:e,viewerName:t,viewerAvatar:n}),Error(r.VIEWER_PARAMS_ERROR);await Promise.all([this.setViewerInfo({viewerId:e,viewerName:t,viewerAvatar:n}),this.setMarqueeConfig({code:i})]),this.isInit=!0,this.logger.info(`初始化服务完成`)}catch(e){throw this.logger.error(`初始化服务失败`,e),e}}async setUserInfo({appId:e,userId:t,appSecret:n}){if(this.ensureEnv(),this.userinfoDone=!1,!this.isInit)throw Error(r.NOT_INITIALIZED);if(!e||!t||!n)throw Error(r.USER_PARAMS_ERROR);this.logger.info(`设置用户信息`,{appId:e,userId:t});try{await this._promisify(r=>this.configModule.setConfig({appId:e,userId:t,appSecret:n},r)),this.userinfoDone=!0,this.logger.info(`设置用户信息成功`)}catch(e){throw this.logger.error(`设置用户信息失败`,e),e}}async loginLiveRoom({sceneType:e,channelId:t}){if(this.logger.info(`登录直播房间`,e,t),this.ensureEnv(),this.checkSystem(),e===void 0||t===void 0)throw Error(r.ROOM_PARAMS_ERROR);this.logger.info(`登录直播房间`,{sceneType:e,channelId:t});try{await this._promisify(n=>this.playModule.loginLiveRoom(e,{channelId:t},n)),this.logger.info(`登录直播房间成功`)}catch(e){throw this.logger.error(`登录直播房间失败`,e),e}}async loginPlaybackRoom({sceneType:e,channelId:t,videoId:n,vodType:i}){if(this.logger.info(`登录回放房间`,{sceneType:e,channelId:t,videoId:n,vodType:i}),this.ensureEnv(),this.checkSystem(),e===void 0||t===void 0||i===void 0)throw Error(r.ROOM_PARAMS_ERROR);this.logger.info(`登录回放房间`,{sceneType:e,channelId:t,videoId:n,vodType:i});try{await this._promisify(r=>this.playModule.loginPlaybackRoom(e,{channelId:t,videoId:n,vodType:i},r)),this.logger.info(`登录回放房间成功`)}catch(e){throw this.logger.error(`登录回放房间失败`,e),e}}logoutRoomMessage(e){this.ensureEnv(),this.logger.info(`当前系统os:`,this.os),this.logger.warn(`非ios系统不注册退出房间回调`),this.os===`ios`&&(this.logger.info(`注册退出房间`),this.playModule.setExitRoomCallback?.(t=>{this.logger.info(`退出房间成功`),e&&e(t)}))}showFullScreenButtonOnIPad(){this.logger.info(`显示 iPad 全屏按钮`),this.ensureEnv(),this.playModule.showFullScreenButtonOnIPad?.({show:!0})}},c=class extends o{constructor(e){super({...e,type:i.LiveScenesHostPlugin})}async initService({viewerId:e,viewerName:t,viewerAvatar:n,code:i=``}){try{if(this.ensureEnv(),this.isInit=!1,this.logger.info(`开始初始化主播服务`),!e||!t||!n)throw this.logger.error(`初始化服务失败，参数错误`,{viewerId:e,viewerName:t,viewerAvatar:n}),Error(r.VIEWER_PARAMS_ERROR);await Promise.all([this.setViewerInfo({viewerId:e,viewerName:t,viewerAvatar:n}),this.setMarqueeConfig({code:i})]),this.isInit=!0,this.logger.info(`初始化主播服务完成`)}catch(e){throw this.logger.error(`初始化主播服务失败`,e),e}}async setViewerInfo({viewerId:e,viewerName:t,viewerAvatar:n}){if(this.ensureEnv(),!e||!t||!n)throw Error(r.VIEWER_PARAMS_ERROR);this.logger.info(`设置观看者信息`,{viewerId:e,viewerName:t});try{await this._promisify(r=>this.configModule.setViewerInfo({viewerId:e,viewerName:t,viewerAvatar:n},r)),this.logger.info(`设置观看者信息成功`)}catch(e){throw this.logger.error(`设置观看者信息失败`,e),e}}async setMarqueeConfig({code:e=``}){this.ensureEnv(),this.logger.info(`设置跑马灯配置`,{code:e});try{await this._promisify(t=>this.configModule.setMarqueeConfig({code:e},t)),this.logger.info(`设置跑马灯配置成功`)}catch(e){throw this.logger.error(`设置跑马灯配置失败`,e),e}}async setUserInfo({appId:e,userId:t,appSecret:n}){if(this.ensureEnv(),this.userinfoDone=!1,!this.isInit)throw Error(r.NOT_INITIALIZED);if(!e||!t||!n)throw Error(r.USER_PARAMS_ERROR);this.logger.info(`设置用户信息`,{appId:e,userId:t});try{await this._promisify(r=>this.configModule.setConfig({appId:e,userId:t,appSecret:n},r)),this.userinfoDone=!0,this.logger.info(`设置用户信息成功`)}catch(e){throw this.logger.error(`设置用户信息失败`,e),e}}async loginLiveRoom({sceneType:e,channelId:t}){if(this.logger.info(`登录直播房间`,e,t),this.ensureEnv(),this.checkSystem(),e===void 0||t===void 0)throw Error(r.ROOM_PARAMS_ERROR);this.logger.info(`登录直播房间`,{sceneType:e,channelId:t});try{await this._promisify(n=>this.playModule.loginLiveRoom(e,{channelId:t},n)),this.logger.info(`登录直播房间成功`)}catch(e){throw this.logger.error(`登录直播房间失败`,e),e}}async loginPlaybackRoom({sceneType:e,channelId:t,videoId:n,vodType:i}){if(this.logger.info(`登录回放房间`,{sceneType:e,channelId:t,videoId:n,vodType:i}),this.ensureEnv(),this.checkSystem(),e===void 0||t===void 0||i===void 0)throw Error(r.ROOM_PARAMS_ERROR);this.logger.info(`登录回放房间`,{sceneType:e,channelId:t,videoId:n,vodType:i});try{await this._promisify(r=>this.playModule.loginPlaybackRoom(e,{channelId:t,videoId:n,vodType:i},r)),this.logger.info(`登录回放房间成功`)}catch(e){throw this.logger.error(`登录回放房间失败`,e),e}}logoutRoomMessage(e){if(this.ensureEnv(),this.logger.info(`当前系统os:`,this.os),this.os!==`ios`){this.logger.warn(`非ios系统不注册退出房间回调`);return}this.logger.info(`注册退出房间`),this.playModule.setExitRoomCallback?.(t=>{this.logger.info(`退出房间成功`),e&&e(t)})}showFullScreenButtonOnIPad(){this.logger.info(`显示 iPad 全屏按钮`),this.ensureEnv(),this.playModule.showFullScreenButtonOnIPad?.({show:!0})}async setScreenShareGroup(e){if(this.logger.info(`设置屏幕共享组`,e),this.os!==`ios`){this.logger.warn(`非ios系统不设置屏幕共享组`);return}if(this.ensureEnv(),!this.streamerConfigModule)throw this.logger.error(`主播配置模块不存在`),Error(`STREAMER_CONFIG_MODULE_MISSING`);await this._promisify(t=>this.streamerConfigModule.setAppGroup({appGroup:e},t))}async loginStreamer(e){this.logger.info(`主播登陆`,e),this.ensureEnv();let{channelId:t,password:n,nickname:i}=e;if(!n||!t)throw Error(r.HOST_ROOM_PARAMS_ERROR);if(!this.streamerPlayModule)throw this.logger.error(`主播播放模块不存在`),Error(`STREAMER_PLAY_MODULE_MISSING`);await this._promisify(e=>this.streamerPlayModule.loginStreamer({channelId:t,password:n,nickname:i},e))}};function l(e){let t=e?.type??i.LiveScenesPlugin,n={[i.LiveScenesHostPlugin]:c,[i.LiveScenesPlugin]:s}[t];return new n(e)}function u(e){return e.pluginType===i.LiveScenesHostPlugin}let d=function(e){return e[e.CloudClass=1]=`CloudClass`,e[e.Shopping=2]=`Shopping`,e}({}),f=null;const p=e=>(f||=l(e),f);var m=p;export{o as BasePlugin,p as PLVLiveScenesPluginHelper,i as PluginType,d as SceneType,c as StreamerPlugin,s as WatchPlugin,l as createPlugin,m as default,u as isStreamerPlugin};